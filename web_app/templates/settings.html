{% extends 'base.html' %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="{{ url_for('static', filename='lib/bootstrap4-toggle.css') }}">

{% endblock %}

{% block content %}
<div class="container">
<h4>Services:</h4>
<!-- ######## Main Service ########-->
  <div id="main_service_space" class="form-group row pt-3 pb-3">
    <div class="col">
    <label for="main-switch" class="col-4 col-form-label col-form-label-lg">Main service</label>
    <input id="main-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ main_settings[0].source_section }}" aria-expanded="false" aria-controls="main_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service manages the connection with the GNSS receiver. Here you can set its parameters. It is mandatory, all other services depend on this one.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
    </div>
  </div>
      <form id="{{ main_settings.pop(0).source_section }}" class="collapse was-validated">

        <div class="form-group row">
        <label for="position" class="col-sm-3 col-form-label">Base coordinates: </label>
        <div class="col-sm-9">
            <input id="position" type="text" name="position" class="form-control" value="{{ main_settings[0].position }}" title="antenna coordinates: latitude longitude elevation" pattern="-?\d{1,3}\.\d+[\s]-?\d{1,3}\.\d+[\s][-+]?\d+\.\d+" required>
            <div class="invalid-feedback">Antenna's coordinates: latitude longitude elevation</div>
        </div>
    </div>
    <div class="form-group row">

        <label for="com_port" class="col-sm-3 col-form-label">Com port: </label>
        <div class="col-sm-6">
            <input id="com_port" type="text" name="com_port" class="form-control" value="{{ main_settings[1].com_port }}" title="Gnss receiver com port (without /dev/)" pattern="\w+[^\|><\/\s]*" required>
            <div class="invalid-feedback">Gnss receiver com port (without /dev/)</div>
        </div>
        <div class="col-sm-3 dropdown">
          <button class="btn btn-secondary dropdown-toggle float-right" type="button" id="dropdowndetect" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Try to detect and/or configure the GNSS receiver. It works only with USB GNSS receiver">Detect/Configure</button>
          <div class="dropdown-menu" aria-labelledby="dropdowndetect">
            <a class="dropdown-item" id="detect_receiver_button" href="#">Detect</a>
            <a class="dropdown-item" id="configure_receiver_button" href="#">Configure</a>
            <a class="dropdown-item" id="detect_and_configure_receiver_button" href="#">Detect and Configure</a>
          </div>
        </div>
    </div>
    <div class="form-group row">

        <label for="com_port_settings" class="col-sm-3 col-form-label">Com port settings: </label>
        <div class="col-sm-9">
            <input id="com_port_settings" type="text" name="com_port_settings" class="form-control" value="{{ main_settings[2].com_port_settings }}" title="Com port settings: baudrate:data bits:parity:stop bits:flow control" pattern="\w[^\|><\/\s]*" required>
            <div class="invalid-feedback">Com port settings: baudrate:data bits:parity:stop bits:flow control</div>
        </div>
    </div>
    <div class="form-group row">

        <label for="receiver" class="col-sm-3 col-form-label">Receiver type: </label>
        <div class="col-sm-9">
            <input id="receiver" type="text" name="receiver" class="form-control" value="{{ main_settings[3].receiver }}" title="Gnss receiver Brand and model" pattern="\w[^\|><\/\s]*" required >
            <div class="invalid-feedback">Gnss receiver brand and model</div>

        </div>
    </div>
    <div class="form-group row">

        <label for="receiver_format" class="col-sm-3 col-form-label">Receiver format: </label>
        <div class="col-sm-9">
            <input id="receiver_format" type="text" name="receiver_format" class="form-control" value="{{ main_settings[5].receiver_format }}" title="Gnss receiver format (ubx,stq,rtcm3,tersus,...)" pattern="\w[^\|><\/\s]*" required>
            <div class="invalid-feedback">Gnss receiver format (ubx,stq,rtcm3,tersus,...)</div>

        </div>

    </div>
    <div class="form-group row">

      <label for="antenna_info" class="col-sm-3 col-form-label">Antenna info: </label>
      <div class="col-sm-9">
          <input id="antenna_info" type="text" name="antenna_info" class="form-control" value="{{ main_settings[6].antenna_info }}" title="Antenna information (model,serial number)" pattern="\w[^\|><\/\s]*" required>
          <div class="invalid-feedback">Antenna information (model,serial number) - default value is NULLANTENNA</div>

      </div>

  </div>
    <div class="form-group row">

        <label for="tcp_port" class="col-sm-3 col-form-label">Tcp port: </label>
        <div class="col-sm-9">
            <input id="tcp_port" type="text" name="tcp_port" class="form-control" value="{{ main_settings[7].tcp_port }}" title="local tcp port" pattern="[0-9]{4,5}" required>
            <div class="invalid-feedback">Local tcp port</div>

        </div>

    </div>
          <div class="clearfix">
            <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
          </div>
      </form>

<!-- ######## Ntrip A Service ########-->
  <div id="ntrip_A_service_space" class="form-group row">
    <div class="col">
    <label for="ntrip_A-switch" class="col-4 col-form-label col-form-label-lg">Ntrip A service</label>
    <input id="ntrip_A-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ ntrip_A_settings[0].source_section }}" aria-expanded="false" aria-controls="ntrip_A_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service sends the rtcm messages to a Ntrip (broad)caster server like rtk2go, centipede, or others.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
    </div>
  </div>
    <form id="{{ ntrip_A_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="svr_addr_A" class="col-sm-3 col-form-label">Caster address: </label>
        <div class="col-sm-9">
            <input id="svr_addr_A" type="text" name="svr_addr_A" class="form-control" value="{{ ntrip_A_settings[0].svr_addr_A }}" title="caster url address" pattern="\w+[^\|><\s]*" required>
            <div class="invalid-feedback">Caster url address</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="svr_port_A" class="col-sm-3 col-form-label">Caster port: </label>
        <div class="col-sm-9">
            <input id="svr_port_A" type="text" name="svr_port_A" class="form-control" value="{{ ntrip_A_settings[1].svr_port_A }}" title="caster port" pattern="[0-9]{4,5}" required>
            <div class="invalid-feedback">Caster port</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="svr_pwd_A" class="col-sm-3 col-form-label">Caster password: </label>
        <div class="col-sm-9">
          <div class="input-group">
            <input id="svr_pwd_A" type="password" name="svr_pwd_A" class="form-control" value="{{ ntrip_A_settings[2].svr_pwd_A }}" title="caster password" required>
              <span class="input-group-append">
                <button class="btn btn-outline-secondary" id="svr_pwd_A_button" type="button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                    <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
                    <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
                    <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
                  </svg>
                </button>
              </span>
            </div>
            <div class="invalid-feedback">Caster password</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="mnt_name_A" class="col-sm-3 col-form-label">Mount name: </label>
        <div class="col-sm-9">
            <input id="mnt_name_A" type="text" name="mnt_name_A" class="form-control" value="{{ ntrip_A_settings[3].mnt_name_A }}" title="Mount name" pattern="[a-zA-Z\d_\-]+" required>
            <div class="invalid-feedback">Mount name</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_msg_A" class="col-sm-3 col-form-label">Rtcm messages: </label>
        <div class="col-sm-9">
            <input id="rtcm_msg_A" type="text" name="rtcm_msg_A" class="form-control" value="{{ ntrip_A_settings[4].rtcm_msg_A }}" title="rtcm messages list" pattern="[0-9,().]+" required>
            <div class="invalid-feedback">Rtcm messages list</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="ntrip_A_receiver_options" class="col-sm-3 col-form-label">Receiver options: </label>
        <div class="col-sm-9">
            <input id="ntrip_A_receiver_options" type="text" name="ntrip_A_receiver_options" class="form-control" value="{{ ntrip_A_settings[5].ntrip_A_receiver_options }}" title="Receiver options" pattern="[^\|><\/]*">
            <div class="invalid-feedback">Receiver dependent options</div>
        </div>
      </div>      

        <div class="clearfix">
          <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
        </div>
    </form>

  <!-- ######## Ntrip B Service ########-->
  <div id="ntrip_B_service_space" class="form-group row">
    <div class="col">
    <label for="ntrip_B-switch" class="col-4 col-form-label col-form-label-lg">Ntrip B service</label>
    <input id="ntrip_B-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ ntrip_B_settings[0].source_section }}" aria-expanded="false" aria-controls="ntrip_B_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service sends the rtcm messages to a Ntrip (broad)caster server like rtk2go, centipede, or others.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
    </div>
  </div>
    <form id="{{ ntrip_B_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="svr_addr_B" class="col-sm-3 col-form-label">Caster address: </label>
        <div class="col-sm-9">
            <input id="svr_addr_B" type="text" name="svr_addr_B" class="form-control" value="{{ ntrip_B_settings[0].svr_addr_B }}" title="caster url address" pattern="\w+[^\|><\s]*" required>
            <div class="invalid-feedback">Caster url address</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="svr_port_B" class="col-sm-3 col-form-label">Caster port: </label>
        <div class="col-sm-9">
            <input id="svr_port_B" type="text" name="svr_port_B" class="form-control" value="{{ ntrip_B_settings[1].svr_port_B }}" title="caster port" pattern="[0-9]{4,5}" required>
            <div class="invalid-feedback">Caster port</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="svr_pwd_B" class="col-sm-3 col-form-label">Caster password: </label>
        <div class="col-sm-9">
          <div class="input-group">
            <input id="svr_pwd_B" type="password" name="svr_pwd_B" class="form-control" value="{{ ntrip_B_settings[2].svr_pwd_B }}" title="caster password" required>
              <span class="input-group-append">
                <button class="btn btn-outline-secondary" id="svr_pwd_B_button" type="button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                    <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
                    <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
                    <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
                  </svg>
                </button>
              </span>
            </div>
            <div class="invalid-feedback">Caster password</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="mnt_name_B" class="col-sm-3 col-form-label">Mount name: </label>
        <div class="col-sm-9">
            <input id="mnt_name_B" type="text" name="mnt_name_B" class="form-control" value="{{ ntrip_B_settings[3].mnt_name_B }}" title="Mount name" pattern="[a-zA-Z\d_\-]+" required>
            <div class="invalid-feedback">Mount name</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_msg_B" class="col-sm-3 col-form-label">Rtcm messages: </label>
        <div class="col-sm-9">
            <input id="rtcm_msg_B" type="text" name="rtcm_msg_B" class="form-control" value="{{ ntrip_B_settings[4].rtcm_msg_B }}" title="rtcm messages list" pattern="[0-9,().]+" required>
            <div class="invalid-feedback">Rtcm messages list</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="ntrip_B_receiver_options" class="col-sm-3 col-form-label">Receiver options: </label>
        <div class="col-sm-9">
            <input id="ntrip_B_receiver_options" type="text" name="ntrip_B_receiver_options" class="form-control" value="{{ ntrip_B_settings[5].ntrip_B_receiver_options }}" title="Receiver options" pattern="[^\|><\/]*">
            <div class="invalid-feedback">Receiver dependent options</div>
        </div>
      </div>      

        <div class="clearfix">
          <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
        </div>
    </form>

  <!-- ######## Local Ntrip Caster Service ########-->
  <div id="local_ntripc_service_space" class="form-group row">
    <div class="col">
    <label for="ntripc-switch" class="col-4 col-form-label col-form-label-lg">Ntrip Caster service</label>
    <input id="ntripc-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ local_ntripc_settings[0].source_section }}" aria-expanded="false" aria-controls="local_ntripc_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service enable a local Ntrip caster directly inside you base station. It's useful if you can't or don't want to use another caster. Make sure that your router is configured correctly if you want to connect to the caster outside of your local network.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
  </div>
  </div>
    <form id="{{ local_ntripc_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="local_ntripc_user" class="col-sm-3 col-form-label">Local caster username: </label>
        <div class="col-sm-9">
            <input id="local_ntripc_user" type="text" name="local_ntripc_user" class="form-control" value="{{ local_ntripc_settings[0].local_ntripc_user }}" title="Local Ntrip caster username for the rover" pattern="\w+[^\|><\s]*">
            <div class="invalid-feedback">Local Ntrip caster username for the rover</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="local_ntripc_pwd" class="col-sm-3 col-form-label">Local caster password: </label>
        <div class="col-sm-9">
          <div class="input-group">
            <input id="local_ntripc_pwd" type="password" name="local_ntripc_pwd" class="form-control" value="{{ local_ntripc_settings[1].local_ntripc_pwd }}" title="local Ntrip caster password for the rover" pattern="\w+[^\|><\s]*">
              <span class="input-group-append">
                <button class="btn btn-outline-secondary" id="local_ntripc_pwd_button" type="button">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                    <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
                    <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
                    <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
                  </svg>
                </button>
              </span>
            </div>
            <div class="invalid-feedback">Local Ntrip caster password for the rover</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="local_ntripc_port" class="col-sm-3 col-form-label">Local caster port: </label>
        <div class="col-sm-9">
            <input id="local_ntripc_port" type="text" name="local_ntripc_port" class="form-control" value="{{ local_ntripc_settings[2].local_ntripc_port }}" title="local Ntrip caster port number" pattern="[0-9]{4,5}" required>
            <div class="invalid-feedback">Local Ntrip Caster port number, e.g. 2101</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="local_ntripc_mnt_name" class="col-sm-3 col-form-label">Local caster mount name: </label>
        <div class="col-sm-9">
            <input id="local_ntripc_mnt_name" type="text" name="local_ntripc_mnt_name" class="form-control" value="{{ local_ntripc_settings[3].local_ntripc_mnt_name }}" title="Local Ntrip caster Mount name" pattern="[a-zA-Z\d_\-]+" required>
            <div class="invalid-feedback">Local Ntrip caster mount name</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="local_ntripc_msg" class="col-sm-3 col-form-label">Local caster rtcm messages: </label>
        <div class="col-sm-9">
            <input id="local_ntripc_msg" type="text" name="local_ntripc_msg" class="form-control" value="{{ local_ntripc_settings[4].local_ntripc_msg }}" title="Local Ntrip rtcm messages list" pattern="[0-9,().]+" required>
            <div class="invalid-feedback">Local caster Rtcm messages list</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="local_ntripc_receiver_options" class="col-sm-3 col-form-label">Local caster receiver options: </label>
        <div class="col-sm-9">
            <input id="local_ntripc_receiver_options" type="text" name="local_ntripc_receiver_options" class="form-control" value="{{ local_ntripc_settings[5].local_ntripc_receiver_options }}" title="Local Ntrip Caster Receiver options" pattern="[^\|><\/]*">
            <div class="invalid-feedback">Local Ntrip Caster Receiver dependent options, e.g. -TADJ=1 for u-blox</div>
        </div>
      </div>      

        <div class="clearfix">
          <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
        </div>
    </form>

  <!-- ######## RTCM Tcp Service ########-->
  <div id="rtcm_svr_service_space" class="form-group row">
    <div class="col">
    <label for="rtcm_svr-switch" class="col-4 col-form-label col-form-label-lg">Rtcm tcp service</label>
    <input id="rtcm_svr-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ rtcm_svr_settings[0].source_section }}" aria-expanded="false" aria-controls="rtcm_svr_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service, when enabled, allow you to send a rtcm stream on the network.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
    </div>
  </div>
    <form id="{{ rtcm_svr_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="rtcm_svr_port" class="col-sm-3 col-form-label">Rtcm server port: </label>
        <div class="col-sm-9">
            <input id="rtcm_svr_port" type="text" name="rtcm_svr_port" class="form-control" value="{{ rtcm_svr_settings[0].rtcm_svr_port }}" title="rtcm server port" pattern="[0-9]{4,5}" required>
            <div class="invalid-feedback">Rtcm server port</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_svr_msg" class="col-sm-3 col-form-label">Rtcm server messages: </label>
        <div class="col-sm-9">
            <input id="rtcm_svr_msg" type="text" name="rtcm_svr_msg" class="form-control" value="{{ rtcm_svr_settings[1].rtcm_svr_msg }}" title="Rtcm server messages list" pattern="[0-9,().]+" required>
            <div class="invalid-feedback">Rtcm server messages list</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_receiver_options" class="col-sm-3 col-form-label">Receiver options: </label>
        <div class="col-sm-9">
            <input id="rtcm_receiver_options" type="text" name="rtcm_receiver_options" class="form-control" value="{{ rtcm_svr_settings[2].rtcm_receiver_options }}" title="Receiver options" pattern="[^\|><\/]*">
            <div class="invalid-feedback">Receiver dependent options</div>
        </div>
      </div>
        
        <div class="clearfix">
        <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
      </div>
    </form>

    <!-- ######## RTCM Serial Service ########-->
  <div id="rtcm_serial_service_space" class="form-group row">
    <div class="col">
    <label for="rtcm_serial-switch" class="col-4 col-form-label col-form-label-lg">Rtcm serial service</label>
    <input id="rtcm_serial-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ rtcm_serial_settings[0].source_section }}" aria-expanded="false" aria-controls="rtcm_serial_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service, when enabled, can send a rtcm stream to a serial output. The common use is with a serial to radio adapter.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
    </div>
  </div>
    <form id="{{ rtcm_serial_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="out_com_port" class="col-sm-3 col-form-label">Serial output port: </label>
        <div class="col-sm-9">
            <input id="out_com_port" type="text" name="out_com_port" class="form-control" value="{{ rtcm_serial_settings[0].out_com_port }}" title="serial output port" pattern="\w+[^\|><\/\s]*" required>
            <div class="invalid-feedback">Serial output com port (without /dev/)</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="out_com_port_settings" class="col-sm-3 col-form-label">Serial output port settings: </label>
        <div class="col-sm-9">
            <input id="out_com_port_settings" type="text" name="out_com_port_settings" class="form-control" value="{{ rtcm_serial_settings[1].out_com_port_settings }}" title="Serial output port settings: baudrate:data bits:parity:stop bits:flow control" pattern="\w[^\|><\/\s]*" required>
            <div class="invalid-feedback">Serial output port settings</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_serial_msg" class="col-sm-3 col-form-label">Serial Rtcm messages: </label>
        <div class="col-sm-9">
            <input id="rtcm_serial_msg" type="text" name="rtcm_serial_msg" class="form-control" value="{{ rtcm_serial_settings[2].rtcm_serial_msg }}" title="Serial output Rtcm messages list" pattern="[0-9,().]+" required>
            <div class="invalid-feedback">Rtcm serial output messages list</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="rtcm_serial_receiver_options" class="col-sm-3 col-form-label">Receiver options: </label>
        <div class="col-sm-9">
            <input id="rtcm_serial_receiver_options" type="text" name="rtcm_serial_receiver_options" class="form-control" value="{{ rtcm_serial_settings[3].rtcm_serial_receiver_options }}" title="Receiver options" pattern="[^\|><\/]*">
            <div class="invalid-feedback">Receiver dependent options</div>
        </div>
      </div>
        
        <div class="clearfix">
        <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
      </div>
    </form>

  <!-- ######## File Service ########-->
  <div id="file_service_space" class="form-group row">
      <div class="col">
    <label for="file-switch" class="col-4 col-form-label col-form-label-lg">File service</label>
    <input id="file-switch" type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="outline-secondary">
    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#{{ file_settings[0].source_section }}" aria-expanded="false" aria-controls="file_service_options">Options</button>
    <a href="#" data-toggle="tooltip" title="This service, when enabled, store the raw data from the GNSS receiver to a file. It's useful when you want to post-process the data.">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6c757d" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
      </svg>
    </a>
  </div>
  </div>
    <form id="{{ file_settings.pop(0).source_section }}" class="collapse was-validated">
      <div class="form-group row">
        <label for="datadir" class="col-sm-3 col-form-label">Data directory: </label>
        <div class="col-sm-9">
            <input id="datadir" type="text" name="datadir" class="form-control" value="{{ file_settings[0].datadir }}" title="Path to data directory" pattern=".+[^\|\s]" required>
            <div class="invalid-feedback">Path to data directory</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="file_name" class="col-sm-3 col-form-label">File name: </label>
        <div class="col-sm-9">
            <input id="file_name" type="text" name="file_name" class="form-control" value="{{ file_settings[1].file_name }}" title="File name construction" pattern="%Y-%m-%d_%h-%M-%S[^\|><\s]*" required>
            <div class="invalid-feedback">File name construction (should start with %Y-%m-%d_%h-%M-%S)</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="file_rotate_time" class="col-sm-3 col-form-label">File rotation time: </label>
        <div class="col-sm-9">
            <input id="file_rotate_time" type="text" name="file_rotate_time" class="form-control" value="{{ file_settings[2].file_rotate_time }}" title="File rotation time (in hours)" pattern="\d+\.?\d*" required>
            <div class="invalid-feedback">File rotation time (in hour)</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="file_overlap_time" class="col-sm-3 col-form-label">File overlap time: </label>
        <div class="col-sm-9">
            <input id="file_overlap_time" type="text" name="file_overlap_time" class="form-control" value="{{ file_settings[3].file_overlap_time }}" title="File overlap time (in seconds)" pattern="\d+" required>
            <div class="invalid-feedback">File rotation time (in seconds)</div>
        </div>
      </div>
      <div class="form-group row">
        <label for="archive_rotate" class="col-sm-3 col-form-label">Archive duration: </label>
        <div class="col-sm-9">
            <input id="archive_rotate" type="text" name="archive_rotate" class="form-control" value="{{ file_settings[4].archive_rotate }}" title="Archive duration before deletion (in days)" pattern="\d+" required>
            <div class="invalid-feedback">Archive duration before deletion (in days)</div>
        </div>
      </div>
        <div class="clearfix">
          <button type="submit" class="btn btn-primary float-right" disabled>Save</button>
        </div>
    </form>
</div>
<div id="system_settings" class="container">
    <h4> System Settings:</h4>
    <div class="row py-2 align-items-center">
        <div class="col-sm-4">
            <span class="col-sm-3">Rtkbase {{ g.version }}</span>
        </div>
        <div class="col-sm-8">
            <button id="check_update_button" class="btn btn-secondary" type="button">Check update</button>
        </div>
    </div>

    <div class="row py-2">
      <div class="col-sm-4">
        <span class="col-sm-3">Change Password:</span>
      </div>
      <div class="col-sm-8"> 
        <form id="change_password">  
          <!--
          <div class="form-group row">
            <label for="cur_pwd" class="col-sm-3 col-form-label">Current: </label>
            <div class="col-sm-9">
                <input id="cur_pwd" type="password" name="cur_pwd" class="form-control" title="current password" required>
                <div class="invalid-feedback">Current password</div>
            </div>
          </div>
          -->      
          <div class="form-group row">
            <label for="new_password" class="col-sm-3 col-form-label">New: </label>
            <div class="col-sm-9">
                <input id="new_password" type="password" name="new_password" class="form-control" title="new password" required>
                <div class="invalid-feedback">New password</div>
            </div>
          </div>
          <div class="form-group row">
            <label for="confirm_password" class="col-sm-3 col-form-label">Confirm: </label>
            <div class="col-sm-9">
                <input id="confirm_password" type="password" name="confirm_password" class="form-control" title="confirm password" required>
                <div class="invalid-feedback">Confirm password</div>
            </div>
          </div>
          <div class="clearfix">
            <button type="submit" class="btn btn-primary float-right" disabled>Change password</button>
          </div>
        </form>
      </div>
    </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Gnss receiver:</span>
    </div>
    <div class="col-sm-8">
      <span>{{ main_settings[3].receiver }} - {{ main_settings[4].receiver_firmware }}</span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Board:</span>
    </div>
    <div class="col-sm-8">
      <span>{{ g.sbc_model }}</span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Os:</span>
    </div>
    <div class="col-sm-8">
      <span>{{ os_infos.id.capitalize() }}&nbsp;{{ os_infos.version }} ({{ os_infos.codename.capitalize() }})</span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">CPU Temp:</span>
    </div>
    <div class="col-sm-8">
      <span id="cpu_temperature">- C°</span>
      <span>- (highest record: </span>
      <span id="max_cpu_temperature">- C°)</span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Uptime:</span>
    </div>
    <div class="col-sm-8">
      <span id="uptime"></span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Storage:</span>
    </div>
    <div class="col-sm-8">
      <span id="vol_space_used"></span>
      <span>available of </span>
      <span id="vol_space_max"></span>
      <span>- (</span><span id="vol_space_free"></span>
      <span>% used)</span>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Settings:</span>
    </div>
    <div class="col-sm-8">
        <button id="backup-button" class="btn btn-secondary" type="button">Backup</button>
        <button id="restore-button" class="btn btn-secondary" type="button" data-toggle="modal" data-target="#restoreSettingsModal">Restore</button>
        <button id="reset-button" class="btn btn-secondary" type="button" data-toggle="modal" data-target="#resetModal">Reset</button>
    </div>
  </div>

  <div class="row py-2 align-items-center">
    <div class="col-sm-4">
      <span class="col-sm-3">Diagnostic:</span>
    </div>
    <div class="col-sm-8">
        <a href="{{ url_for('diagnostic') }}" target="_blank" class="btn btn-secondary" role="button">View</a>
        <!--<button id="download-diag-button" class="btn btn-secondary" type="button" disabled>Download</button>-->
    </div>
  </div>

    <div class="row py-2 align-items-center">
      <div class="col-sm-4">
        <span class="col-sm-3">Power:</span>
      </div>
      <div class="col-sm-8">
          <button id="reboot-button" class="btn btn-secondary" type="button">Reboot</button>
          <button id="shutdown-button" class="btn btn-secondary" type="button">Shutdown</button>
      </div>
  </div>
    
</div>

<!-- The Detect/configure Gnss receiver Modal dialog box-->
<div class="modal" id="detectModal" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">GNSS Receiver detection/configuration</h4>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          <!-- <p id="gnss-detection" class="text-center" hidden><span class="spinner-border spinner-border-sm"></span> Detecting GNSS receiver...'</p> -->
          <p class="text-center"></p>
        </div>       
        <!-- Modal footer -->
        <div class="modal-footer mx-auto">
          <button id="apply-button" type="button" class="btn btn-success" disabled>Apply</button>          
          <button id="cancel-button" type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
        </div>
    </div>
  </div>
</div>

<!-- The update Modal dialog box-->
<div class="modal" id="updateModal" data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">     
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Update</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>       
        <!-- Modal body -->
        <div class="modal-body">          
        </div>       
        <!-- Modal footer -->
        <div class="modal-footer mx-auto">
          <button id="start-update-button" type="button" class="btn btn-success" disabled>Update</button>
          <button id="cancel-button" type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>         
        </div>      
      </div>
    </div>
  </div>

  <!-- The Paswword is changed Modal dialog box-->
<div class="modal" id="passwordChangedModal">
  <div class="modal-dialog">
    <div class="modal-content">     
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Password Update</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>       
      <!-- Modal body -->
      <div class="modal-body text-center ">The password was updated successfuly
      </div>       
      <!-- Modal footer -->
      <div class="modal-footer mx-auto">
        <a href="{{ url_for('logout') }}" class="btn btn-success" role="button">Log out</a>
      </div>      
    </div>
  </div>
</div>

  <!-- The restore settings Modal dialog box-->
  <div class="modal" id="restoreSettingsModal" data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">     
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Restore saved settings</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>       
        <!-- Modal body -->
        <div class="modal-body text-center ">
          <p>Restore RTKBase with previously saved settings.</p>
          <form id="restore-form" method="POST" action="settings" enctype="multipart/form-data">
            <p><input type="file" name="file">
              <!--<input type="submit" class="btn btn-danger" role="button" value="Restore">-->
            </p><p id="restoration_server_answer"></p>
        </form>
        </div>       
        <!-- Modal footer -->
        <div class="modal-footer mx-auto">
          <a href="{{ url_for('logout') }}" id="restore-logout-button" class="btn btn-success" role="button" style="display: none;">Logout</a>
          <!--<button id="restore-logout-button" type="button" class="btn btn-success" style="display: none;">Logout</button> -->
          <button id="restore-settings-button" type="button" class="btn btn-danger" disabled>Restore Settings</button>
          <button type="button" id="restore-cancel-button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
        </div>      
      </div>
    </div>
  </div>

<!-- The Reset settings Modal dialog box-->
<div class="modal" id="resetModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Reset settings</h4>
      </div>
      <!-- Modal body -->
      <div class="modal-body text-center ">
        <p>Reset RTKBase to default settings (including password). You will be redirected to the login page.</p>
        <p>Are you sure?</p>          
      </div>
      <!-- Modal footer -->
      <div class="modal-footer mx-auto">
        <button id="confirm-reset-button" type="button" class="btn btn-danger">Reset</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
      </div>     
    </div>
  </div>
</div>

  <!-- The reboot Modal dialog box-->
<div class="modal" id="rebootModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Reboot</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body -->
      <div class="modal-body text-center ">Reboot the GNSS Base. Are you sure?          
      </div>
      <!-- Modal footer -->
      <div class="modal-footer mx-auto">
        <button id="confirm-reboot-button" type="button" class="btn btn-danger">Reboot</button>
        <button id="reboot-cancel-button" type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
      </div>     
    </div>
  </div>
</div>

<!-- The shutdown Modal dialog box-->
<div class="modal" id="shutdownModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Shutdown</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body -->
      <div class="modal-body text-center ">Shutdown the GNSS Base. Are you sure?          
      </div>
      <!-- Modal footer -->
      <div class="modal-footer mx-auto">
        <button id="confirm-shutdown-button" type="button" class="btn btn-danger">Shutdown</button>
        <button id="shutdown-cancel-button" type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
      </div>     
    </div>
  </div>
</div>

{% endblock %}


{% block scripts %}
{{super()}}
<script type="text/javascript" src="{{ url_for('static', filename='lib/bootstrap4-toggle.js') }}" charset="utf-8"></script>
<script type="text/javascript" src="{{ url_for('static', filename='settings.js', v=g.version) }}" charset="utf-8"></script>
{% endblock %}